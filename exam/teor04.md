#### Расширенная модель “сущность-связь” (EER)

EER-модель расширяет ER-модель, добавляя новые семантические конструкции.

**Основные возможности EER-модели:**

* **Категоризация сущностей:**  Представление сущности в виде подтипов,  наследующих общие атрибуты от супертипа и имеющих собственные уникальные атрибуты.

   * **Супертип:**  Обобщенная сущность, содержащая общие характеристики.
   * **Подтип:** Специализированная сущность, наследующая характеристики супертипа и добавляющая свои собственные.
   * **Узел-дискриминатор:** Графическое обозначение принципа категоризации.

**Преимущества использования подтипов:**

* Избежание Null-значений в атрибутах.
* Возможность определения связей, уникальных для конкретного подтипа.

**Критерии использования подтипов и супертипов:**

*  Наличие различных типов сущностей с точки зрения пользователя.
*  Наличие уникальных атрибутов для каждого типа экземпляров.

## Даталогическое проектирование

**Даталогическое проектирование:** Этап проектирования БД с учетом выбранной СУБД и модели данных.

**Результат:**  Визуализация даталогической модели с помощью программных средств.

**Особенности проектирования на разных уровнях:**

| Уровень        | Назначение                                         | Элементы модели                                                                                                                                            |
| -------------- | -------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Инфологический | Описание предметной области без привязки к типу БД | Сущности, атрибуты, типы связей между сущностями                                                                                                           |
| Даталогический | Описание предметной области с привязкой к типу БД  | Сущности, атрибуты, связи, ключи, индексы, представления                                                                                                   |
| Физический     | Реализация БД под управлением конкретной СУБД      | Сущности, атрибуты, связи, ключи, индексы, триггеры, представления, хранимые процедуры, методы доступа, пользовательские функции, права доступа, кодировки |

## Переход к реляционной модели данных

**Этапы преобразования EER-модели в реляционную модель:**

1. **Преобразование сущностей:** 
   * Каждой сущности ставится в соответствие отношение (таблица). 
   * Имена сущности и отношения могут отличаться.

2. **Преобразование атрибутов:**
   * Каждый атрибут сущности становится атрибутом (столбцом) отношения.
   * Задается тип данных и обязательность атрибута (NULL/NOT NULL).

3. **Преобразование первичного ключа:**
   * Первичный ключ сущности становится PRIMARY KEY (PK) отношения.
   * Атрибуты PK получают свойство NOT NULL.

4. **Преобразование внешнего ключа:**
   * В отношения, соответствующие подчиненным сущностям, добавляется набор атрибутов, являющийся PK  основной сущности. 
   * Этот набор атрибутов становится FOREIGN KEY (FK)  в подчиненном отношении.

5. **Обязательность связей:**
   * Для необязательных связей атрибуты FK допускают NULL-значения.
   * Для обязательных связей атрибуты FK не допускают NULL-значения (NOT NULL).

6. **Преобразование категоризации:**
   *  **Вариант 1:** Создание одного отношения для всех подтипов с включением всех атрибутов (возможны Null-значения).
   * **Вариант 2:**  Создание отдельных отношений для супертипа и каждого подтипа.

     *  В супертип включается идентификатор связи для обеспечения переходов к подтипам.
     *  Определяется наследование: только идентификатор супертипа или все атрибуты.

### Разрешение связей типа «многие-ко-многим»

* Вводится **связующее отношение (ассоциативное отношение)**, связанное с каждым исходным отношением связью "один-ко-многим".
* Атрибутами связующего отношения становятся PK связываемых отношений.
* Каждый атрибут связующего отношения является FK.

**Варианты определения PK составного отношения:**

* Использование комбинации внешних ключей.
* Создание нового первичного ключа.


###  Первичный ключ (PK)

**Функция:** Гарантия целостности объекта.

**Условия целостности отношения:**

*  Уникальность значений PK.
*  Недопустимость NULL-значений в атрибутах PK.

**Свойства PK:**

* **Уникальность:** Однозначная идентификация каждого экземпляра сущности.
* **Неинтеллектуальность:** Отсутствие встроенного семантического значения, кроме уникальной идентификации.
* **Неизменность:**  Изменение PK влечет обновление FK.
* **Желательность одного атрибута:** Упрощение реализации FK.
* **Желательность числового типа:**  Поддержка автоматических атрибутов PK (identity в MS SQL Server).
* **Безопасность:**   PK не должен содержать атрибуты,  угрожающие безопасности (например, номер паспорта).

**Суррогатный ключ:**  Созданный разработчиком PK для упрощения идентификации.


### Внешний ключ (FK)

**Функция:**  Обеспечение ссылочной целостности.

**Ссылочная целостность:**  Условие, при котором каждая ссылка на экземпляр отношения является действительной.

**Правила:**

* Значение FK должно быть либо NULL, либо действительным значением в PK связанной таблицы.
* Ненулевое значение FK должно иметь ссылку на существующее значение PK.


## Правила реляционной модели

| №   | Название правила                                      | Описание                                                                                                                                                                                                                                                                                                                                          |
| --- | ----------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1   | Информационное правило                                | Вся информация в реляционной БД на логическом уровне должна быть явно представлена только значениями в таблицах.                                                                                                                                                                                                                                  |
| 2   | Гарантированный доступ к данным                       | В реляционной БД каждое отдельное (атомарное) значение данных должно быть логически доступно с помощью комбинации имени таблицы, значения первичного ключа и имени столбца.                                                                                                                                                                       |
| 3   | Систематическая поддержка отсутствующих значений      | Значения NULL должны быть представлены и обработаны систематически, независимо от типа данных.                                                                                                                                                                                                                                                    |
| 4   | Доступ к словарю данных в терминах реляционной модели | Метаданные должны сохраняться в форме реляционных таблиц, и СУБД должна поддерживать доступ к ним при помощи стандартных языковых средств.                                                                                                                                                                                                        |
| 5   | Полнота подмножества языка                            | СУБД должна поддерживать хотя бы один реляционный язык, который: имеет линейный синтаксис, может использоваться как интерактивно, так и в прикладных программах,  поддерживает операции определения данных, определения представлений, манипулирования данными, ограничители целостности, управление доступом и операции управления транзакциями. |
| 6   | Возможность изменения представлений                   | Каждое представление должно поддерживать все операции манипулирования данными, которые поддерживают реляционные таблицы (выборка, вставка, изменение, удаление).                                                                                                                                                                                  |
| 7   | Наличие высокоуровневых операций управления данными   | Операции вставки, изменения и удаления данных должны поддерживаться не только по отношению к одной строке, но и к любому множеству строк.                                                                                                                                                                                                         |
| 8   | Физическая независимость данных                       | Приложения не должны зависеть от используемых способов хранения данных,  аппаратного обеспечения.                                                                                                                                                                                                                                                 |
| 9   | Логическая независимость данных                       | Представление данных в приложении не должно зависеть от структуры таблиц. Изменение структуры таблиц не должно сказываться на работе приложений.                                                                                                                                                                                                  |
| 10  | Независимость контроля целостности                    | Все ограничения реляционной целостности должны быть определены на реляционном языке и храниться в системном каталоге, а не на уровне приложения.                                                                                                                                                                                                  |
| 11  | Независимость от расположения                         | Конечные пользователи и прикладные программы не знают и не зависят от расположения данных (распределенных и локальных баз данных).                                                                                                                                                                                                                |
| 12  | Согласование языковых уровней                         | Низкоуровневый язык доступа к данным не должен игнорировать правила безопасности и правила целостности, поддерживаемые языком более высокого уровня.                                                                                                                                                                                              |
| 0   | Основное правило                                      | Для того, чтобы считаться реляционной, БД должна использовать для управления исключительно свои реляционные возможности.                                                                                                                                                                                                                          |

## Нормализация отношений

**Нормализация** — это процесс, направленный на устранение избыточности информации в реляционных базах данных.

**Цель нормализации:** Обеспечить хранение каждого факта только в одном месте базы данных.

**Процесс нормализации:**  Последовательная проверка отношения на соответствие требованиям нормальных форм. Каждая следующая нормальная форма (НФ) накладывает более строгие ограничения и обладает лучшими свойствами по сравнению с предыдущей.

**Основа нормализации:** Концепция функциональных зависимостей.

**Результат нормализации:** Логическая модель реляционной БД.

### Нормальные формы:

* Первая нормальная форма (1NF)
* Вторая нормальная форма (2NF)
* Третья нормальная форма (3NF)
* Нормальная форма Бойса-Кодда (BCNF)
* Четвертая нормальная форма (4NF)
* Пятая нормальная форма (5NF или PJNF)

**Свойства нормальных форм:**

* Каждая последующая НФ улучшает свойства предыдущей.
* При переходе к следующей НФ свойства предыдущих сохраняются.

### Требования к нормализованной БД:

1. **Минимальность первичных ключей.**
2. **Минимальная избыточность данных.**
3. **Сохранение производительности системы.**
4. **Отсутствие противоречивых данных.**
5. **Устойчивость схемы отношений к изменениям.**
6. **Минимальный разброс времени реакции на запросы.**
7. **Актуальность данных.**

**Противоречие требований:** Некоторые требования противоречат друг другу (например, производительность и гибкость).

**Цели хранения данных в реляционной БД:**

1. **Снижение избыточности данных.**
2. **Повышение достоверности данных.**

**Средство формализации требований:** Зависимости между данными.

## Функциональные зависимости

**Определение:** Пусть r(A1, A2, ..., An) — схема отношения R, a X и Y — подмножества r. Говорят, что X **функционально** определяет Y, если каждому значению атрибутов кортежа из X соответствует не более одного значения атрибутов того же кортежа из Y: F: X → Y.

**Пример:**

```
ГРАФИК_ПОЛЕТОВ (Пилот, Рейс, Дата_вылета, Время_вылета)
```

**Функциональные зависимости:**

* Рейс → Время_вылета
* (Пилот, Дата_вылета, Время_вылета) → Рейс
* (Рейс, Дата_вылета) → Пилот

## Транзитивные зависимости (Т-зависимости)

**Определение:** Пусть X, Y, Z — атрибуты отношения R. Если имеются ФЗ F: X → Y и F: Y → Z, но отсутствуют ФЗ F: Z → Y и F: Y → X, то Z **транзитивно** зависит от X.

**Возникновение:**  Когда неключевой атрибут зависит от другого неключевого атрибута.

**Пример:**

```
СОТРУДНИКИ (Табельный_номер, ФИО, Должность, Оклад)
```

* Табельный_номер → Должность
* Должность → Оклад
* **Т-зависимость:** Оклад транзитивно зависит от Табельного_номера.

## Аномалии модификации данных

**Причины:** 

* Модификация данных (вставка, удаление, обновление).
* Использование ненормализованных таблиц.

**Проявления:**

* **Несогласованность данных.**
* **Противоречивость данных.**
* **Избыточность данных.**
* **Нарушение целостности данных.**

**Типы аномалий:**

* **Аномалия обновления:** Изменение данных в одной записи требует изменения в нескольких записях.
* **Аномалия вставки:** Невозможность добавления данных без добавления данных о другой сущности.
* **Аномалия удаления:** Удаление данных об одной сущности влечет удаление данных о другой сущности.

**Решение:** Нормализация отношений.

## Первая нормальная форма (1NF)

**Определение:** Отношение находится в 1NF, если на пересечении каждого столбца и каждой строки находятся только **элементарные (атомарные)** значения атрибутов.

**Нарушение 1NF:** Наличие групп атрибутов, описывающих одно и то же свойство.

**Пример:**

```
Студент (Номер_в_ведомости, Фамилия, Имя, Отчество, Адрес, Телефон_1, Телефон_2, Хобби_1, Хобби_2, Хобби_3) 
```

**Проблема:** Атрибуты "Телефон_1", "Телефон_2", "Хобби_1", "Хобби_2", "Хобби_3" нарушают 1NF.

**Решение:**

1. Выделить атрибуты, характеризующие разные признаки.
2. Создать новые сущности для каждой группы повторяющихся атрибутов.
3. Задать связи между сущностями.
4. Выбрать (или создать) первичные ключи в новых сущностях.

**Пример нормализованной модели:**

```
Студент (Номер_в_ведомости, Фамилия, Имя, Отчество, Адрес)
Телефон (Номер_в_ведомости (FK), Телефон)
Хобби (Номер_в_ведомости (FK), Хобби)
```

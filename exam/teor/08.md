## Операторы DDL с заданием ограничений целостности

### Целостность данных

**Целостность данных** - это соответствие информационной модели предметной области, хранимой в БД, объектам реального мира и их взаимосвязям в каждый момент времени.

**Обеспечение целостности:**

*  Отслеживание согласованных изменений в БД.
*  Сохранение однозначной интерпретации данных.

### Аспекты целостности в реляционной модели данных:

1. **Структурная целостность:** Работа только с однородными структурами данных (реляционными отношениями).
2. **Языковая целостность:**  Использование языков описания и манипулирования данными не ниже стандарта SQL.
3. **Ссылочная целостность:**  Обеспечение заданных правил взаимосвязи между кортежами связанных отношений.

### Ограничения целостности в SQL

**Декларативные ограничения:** Задаются на уровне операторов создания таблиц (CREATE TABLE).

**Синтаксис оператора CREATE TABLE:**

```sql
CREATE TABLE <имя таблицы> (
    <имя столбца> <тип данных> [<значение по умолчанию>] 
    [<ограничения столбца>] 
    [<ограничение уникальности столбца>]
    [<ограничение по ссылкам столбца>]
    [CHECK (<условие проверки>)]
    [<определение ограничений таблицы>]
);
```

**Ограничения столбца:**

* **NOT NULL:**  Запрет на NULL-значения.
* **UNIQUE:** Запрет на дубликаты значений.
* **PRIMARY KEY:** Ограничение первичного ключа (NOT NULL + UNIQUE).
* **FOREIGN KEY:**  Ограничение внешнего ключа (ссылка на PK другой таблицы).
* **CHECK:**  Проверка значений с помощью логического выражения.
* **DEFAULT:** Значение по умолчанию.

**Пример:**

```sql
CREATE TABLE BOOKS (
    ISBN VARCHAR(14) NOT NULL PRIMARY KEY,
    TITLE VARCHAR(120) NOT NULL,
    YEAR_PUBL SMALLINT DEFAULT YEAR(GETDATE()),
    PUBLICH VARCHAR(20) NULL,
    PAGES SMALLINT CHECK (PAGES >= 5 AND PAGES <= 1000)
);
```

**Скрипт SQL:** Набор операторов SQL, выполняемых последовательно.

**Пример скрипта:**

```sql
CREATE TABLE CATALOG (
    ID_CATALOG SMALLINT NOT NULL PRIMARY KEY,
    KNOWELEDGE_AREA VARCHAR(150)
);

CREATE TABLE RELATION_ (
    ISBN VARCHAR(14) NOT NULL FOREIGN KEY REFERENCES BOOKS(ISBN),
    ID_CATALOG SMALLINT NOT NULL FOREIGN KEY REFERENCES CATALOG(ID_CATALOG),
    CONSTRAINT PK_RELATION_1 PRIMARY KEY (ISBN, ID_CATALOG)
);
```

###  Оператор ALTER TABLE

**Назначение:** Изменение структуры существующей таблицы.

**Операции:**

* Добавление столбца (ADD).
* Изменение столбца (ALTER).
* Удаление столбца (DROP).
* Добавление/удаление ограничений (ADD/DROP CONSTRAINT).

**Пример:**

```sql
ALTER TABLE BOOKS ADD PEREPLET CHAR(10) NULL;
```

### Оператор DROP TABLE

**Назначение:** Удаление таблицы.

**Синтаксис:**

```sql
DROP TABLE <имя таблицы> [CASCADE | RESTRICT];
```

**CASCADE:** Удаление зависимых объектов (внешние ключи).
**RESTRICT:**  Запрет на удаление, если есть зависимые объекты.

### Хранимые процедуры и функции

**Хранимая процедура:** Набор SQL-операторов, хранимый на сервере.
**Хранимая функция:**  Хранимая процедура, возвращающая значение.

**Преимущества:**

* Повышение производительности.
* Модульность кода.
* Безопасность.

### Виды (представления)

**Вид (представление):** Виртуальная таблица, основанная на запросе.

**Назначение:**

* Упрощение сложных запросов.
* Обеспечение безопасности данных.

### Триггеры

**Триггер:**  Хранимая процедура, запускаемая автоматически при определенном событии (вставка, обновление, удаление).

**Назначение:**

* Обеспечение сложных ограничений целостности.
* Аудит изменений данных.

### Другие объекты DDL

* **Пользовательский тип данных:**  Ограничение на уровне домена.
* **Пользовательская роль:** Набор прав доступа.
* **Схема данных:**  Контейнер для объектов БД.

## Язык манипулирования данными (DML)

**Операторы:**

* **INSERT:** Вставка строк.
* **UPDATE:**  Обновление строк.
* **DELETE:** Удаление строк.

### Оператор INSERT

**Синтаксис:**

```sql
INSERT INTO <имя таблицы> [(<список столбцов>)] 
VALUES (<список значений>);
```

**Пример:**

```sql
INSERT INTO BOOKS (ISBN, TITLE, YEAR_PUBL, PAGES) 
VALUES ('5-88782-290-2', 'Аппаратные средства PC. Энциклопедия', 2022, 816);
```

### Оператор UPDATE

**Синтаксис:**

```sql
UPDATE <имя таблицы> 
SET <имя столбца> = <новое значение>, ... 
[WHERE <условие>];
```

**Пример:**

```sql
UPDATE BOOKS 
SET YEAR_PUBL = 2023
WHERE ISBN = '5-88782-290-2';
```

### Оператор DELETE

**Синтаксис:**

```sql
DELETE FROM <имя таблицы> [WHERE <условие>];
```

**Пример:**

```sql
DELETE FROM BOOKS 
WHERE YEAR_PUBL < 2000;
```


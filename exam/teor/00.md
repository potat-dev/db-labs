## Проектирование и разработка базы данных

**Этапы:**

1. **Системный анализ и словесное описание предметной области:** Выявление бизнес-процессов, ключевых объектов и связей между ними, определение задач, алгоритмов, форматов данных и выходных документов.
2. **Проектирование инфологической модели:** Формализованное описание объектов предметной области с помощью семантической модели (например, ER-модели).
3. **Выбор СУБД:** Определение подходящей системы управления базами данных.
4. **Даталогическое проектирование:** Описание структуры данных с учетом выбранной СУБД и модели данных.
5. **Физическое проектирование:** Реализация БД на сервере с учетом требований производительности и надежности.

## Инфологическое проектирование

**ER-модель (Entity-Relationship):** Модель "сущность-связь" для визуализации взаимосвязей и свойств объектов.

**Основные понятия:**

* **Сущность:** Объект, который можно однозначно идентифицировать.
* **Атрибут:**  Именованная характеристика сущности.
* **Ключ:** Неизбыточный набор атрибутов, однозначно определяющий экземпляр сущности.
* **Связь:**  Поименованное отношение между двумя сущностями.

**Типы связей:**

* **Один к одному (1:1):**  Каждый экземпляр одной сущности связан только с одним экземпляром другой.
* **Один ко многим (1:M):** Один экземпляр одной сущности может быть связан с несколькими экземплярами другой.
* **Многие ко многим (M:N):** Экземпляры одной сущности могут быть связаны с несколькими экземплярами другой, и наоборот.

**Модальность связей:**

* **Может:**  Экземпляр сущности может быть связан с другим,  а может и не быть.
* **Должен:**  Экземпляр сущности обязательно связан с другим.

**Шаги построения ER-модели:**

1. Определение сущностей.
2. Выделение атрибутов.
3. Определение ключей.
4. Добавление связей.
5. Указание типов связей.

**Нотации ER-моделирования:**

* Чена.
* IDEF1X.
* Бахмана.
* Мартина ("вороньи лапки").
* Баркера.

**Пример ER-модели (нотация Чена):**

```
[Киностудия] 1:M [Фильм] M:N [Актер]
      |                                  |
      1:1                             1:M
      |                                  |
[Президент]                         [Контракт]
```

## Даталогическое проектирование

**Даталогическое проектирование:**  Этап проектирования БД с учетом выбранной СУБД и модели данных.

**Результат:**  Даталогическая модель, определяющая формат хранения данных для каждой сущности и ее атрибутов.

**Инструменты:**

* MySQL Workbench.
* DbDesigner.net.
* WWW SQL Designer.
* Draw.io.

**Уровни проектирования:**

| Уровень        | Назначение                                         | Элементы модели                                                                                                                                            |
| -------------- | -------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Инфологический | Описание предметной области без привязки к типу БД | Сущности, атрибуты, типы связей между сущностями                                                                                                           |
| Даталогический | Описание предметной области с привязкой к типу БД  | Сущности, атрибуты, связи, ключи, индексы, представления                                                                                                   |
| Физический     | Реализация БД под управлением конкретной СУБД      | Сущности, атрибуты, связи, ключи, индексы, триггеры, представления, хранимые процедуры, методы доступа, пользовательские функции, права доступа, кодировки |

## Физическая организация данных

**Архитектура MySQL:** Клиент-серверная.

**Компоненты:**

1. **Уровень подключения (Connection Pools):** Обработка соединений, аутентификация, авторизация.
2. **Сервисный уровень (SQL Interface, Optimizer, Parser):** Интерфейс для выполнения SQL-запросов, оптимизация запросов, синтаксический анализ.
3. **Слой двигателя сервера и механизмов хранения (Storage Engines):** Способ хранения данных, построение индексов, обновление и запрос данных.

**Механизмы хранения MySQL:**

* InnoDB.
* MyISAM.
* Memory.
* Cluster.
* Merge.
* Archive.

**Типы данных MySQL:**

* Числовые (INTEGER, SMALLINT, DECIMAL, FLOAT, DOUBLE, BIT).
* Дата и время (DATE, TIME, DATETIME, TIMESTAMP, YEAR).
* Строковые (CHAR, VARCHAR, TEXT, BLOB, ENUM, SET).
* Пространственные (Geometry).
* JSON.

## Язык SQL

**SQL (Structured Query Language):** Стандартный язык для работы с реляционными БД.

**Категории команд:**

* **DDL (Data Definition Language):**  Определение структуры данных (CREATE, ALTER, DROP).
* **DML (Data Manipulation Language):** Манипулирование данными (INSERT, UPDATE, DELETE).
* **DQL (Data Query Language):**  Запросы к данным (SELECT).
* **DCL (Data Control Language):** Управление доступом (GRANT, REVOKE).
* **TCL (Transaction Control Language):** Управление транзакциями (COMMIT, ROLLBACK, SAVEPOINT).

### Целостность данных

**Целостность данных:**  Соответствие данных бизнес-правилам и ограничениям.

**Виды целостности:**

* **Целостность сущностей:**  Уникальность каждой строки таблицы (обеспечивается первичным ключом).
* **Ссылочная целостность:**  Согласованность связей между таблицами (обеспечивается внешними ключами).
* **Семантическая целостность:**  Соответствие данных бизнес-правилам.
* **Языковая целостность:**  Использование SQL для доступа и изменения данных.

**Стратегии поддержания ссылочной целостности:**

* **RESTRICT:** Запрет операций, нарушающих ссылочную целостность.
* **CASCADE:**  Автоматическое распространение изменений на связанные таблицы.

### Оператор CREATE TABLE

**Синтаксис:**

```sql
CREATE TABLE <имя таблицы> (
    <имя столбца> <тип данных> [<ограничения>],
    ...
);
```

**Ограничения:**

* **NOT NULL:** Запрет на NULL-значения.
* **UNIQUE:** Запрет на дубликаты.
* **PRIMARY KEY:**  Первичный ключ (NOT NULL + UNIQUE).
* **FOREIGN KEY:** Внешний ключ (ссылка на PK другой таблицы).
* **CHECK:**  Проверка значений с помощью логического выражения.
* **DEFAULT:**  Значение по умолчанию.

### Оператор ALTER TABLE

**Назначение:** Изменение структуры таблицы.

**Операции:**

* Добавление столбца.
* Изменение столбца.
* Удаление столбца.
* Добавление/удаление ограничений.

### Операторы DML

* **INSERT:** Вставка строк.
* **UPDATE:**  Обновление строк.
* **DELETE:**  Удаление строк.

### Оператор SELECT

**Назначение:**  Выборка данных.

**Синтаксис:**

```sql
SELECT [ALL | DISTINCT] (<список полей> | *)
FROM <список таблиц>
[WHERE <предикат>]
[GROUP BY <список полей>]
[HAVING <предикат>]
[ORDER BY <список полей>];
```

### Конструкция CASE

**Назначение:**  Условное выполнение операций.

**Синтаксис:**

```sql
CASE
    WHEN <условие1> THEN <результат1>
    [WHEN <условие2> THEN <результат2>]
    ...
    [ELSE <результатN>]
END
```

### Функция COALESCE

**Назначение:** Замена NULL-значений.

**Синтаксис:**

```sql
COALESCE(<выражение1>, <выражение2>, ...)
```

**Возвращает:**  Первое не NULL-значение из списка.

### Операторы фильтрации данных

* **BETWEEN:**  Проверка вхождения значения в диапазон.
* **LIKE:**  Сравнение с шаблоном.
* **IN:**  Проверка вхождения значения в список.
* **IS NULL:**  Проверка на NULL-значение.
* **DISTINCT:**  Выбор уникальных значений.
* **LIMIT:**  Ограничение количества возвращаемых строк.

### Агрегатные функции

* **COUNT:**  Подсчет количества строк или значений.
* **SUM:**  Суммирование значений.
* **AVG:**  Вычисление среднего значения.
* **MIN:**  Нахождение минимального значения.
* **MAX:**  Нахождение максимального значения.

### Соединения таблиц (JOIN)

* **INNER JOIN:**  Совпадающие строки из обеих таблиц.
* **LEFT JOIN:**  Все строки из левой таблицы и совпадающие из правой.
* **RIGHT JOIN:**  Все строки из правой таблицы и совпадающие из левой.
* **FULL JOIN:**  Все строки из обеих таблиц.
* **CROSS JOIN:**  Декартово произведение таблиц.

### Вложенные подзапросы

**Вложенный подзапрос:**  Инструкция `SELECT`, вложенная в другую инструкцию `SELECT`.

### Хранимые процедуры и функции

**Хранимая процедура:**  Набор SQL-операторов, хранимый на сервере.
**Хранимая функция:**  Хранимая процедура, возвращающая значение.

**Преимущества:**

* Повышение производительности.
* Модульность кода.
* Безопасность.

**Синтаксис:**

```sql
CREATE PROCEDURE <имя процедуры> ([параметры])
BEGIN
    -- Код процедуры
END;

CREATE FUNCTION <имя функции> ([параметры]) RETURNS <тип данных>
BEGIN
    -- Код функции
    RETURN <значение>;
END;
```

### Управляющие конструкции в SQL

* **Составной оператор:** `BEGIN ... END`.
* **Переменные:** `DECLARE`.
* **Ветвление:** `IF ... THEN ... ELSE ... END IF`.
* **Множественный выбор:** `CASE`.
* **Циклы:** `WHILE`, `REPEAT`, `LOOP`.

### Триггеры

**Триггер:**  Хранимая процедура, запускаемая автоматически при наступлении события (INSERT, UPDATE, DELETE).

**Типы триггеров:**

* **BEFORE:**  Запускается до события.
* **AFTER:**  Запускается после события.

**Уровни триггеров:**

* **Уровень строки:**  Запускается для каждой строки,  затронутой событием.
* **Уровень оператора:** Запускается один раз для всего оператора.

**Синтаксис:**

```sql
CREATE TRIGGER <имя триггера> <время запуска> <событие>
ON <таблица> FOR EACH ROW
<код триггера>;
```

**Примеры использования триггеров:**

* Автоматический подсчет значений.
* Проверка данных перед записью.
* Ведение журнала операций.
* Каскадное обновление данных.

## Язык управления транзакциями (TCL)

**TCL (Transaction Control Language):** Язык для управления транзакциями в базе данных.

**Операторы TCL:**

| Оператор      | Смысл                       | Действие                                                                                                                               |
| ------------- | --------------------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| **COMMIT**    | Применить транзакцию        | Сохраняет все изменения, сделанные в рамках текущей транзакции, в базе данных.                                                         |
| **ROLLBACK**  | Отменить транзакцию         | Откатывает все изменения, сделанные в рамках текущей транзакции, возвращая базу данных к предыдущему согласованному состоянию.         |
| **SAVEPOINT** | Установить точку сохранения | Создает точку сохранения внутри транзакции, к которой можно откатиться с помощью `ROLLBACK TO SAVEPOINT`, не откатывая всю транзакцию. |

**Особенности:**

* TCL-операторы используются только с DML-операторами (INSERT, UPDATE, DELETE).
* Изменения, сделанные в рамках транзакции, хранятся во временной области до выполнения `COMMIT` или `ROLLBACK`.
* Концепция транзакций – основа обеспечения целостности данных в клиент-серверных базах данных.

### Транзакции

**Транзакция:** Логическая единица работы, которая должна быть выполнена полностью или не выполнена вообще.

**Свойства транзакций (ACID):**

* **Atomicity (Атомарность):** Транзакция неделима, все ее операции выполняются либо все, либо ни одна.
* **Consistency (Согласованность):** Транзакция переводит базу данных из одного согласованного состояния в другое, не нарушая целостность данных.
* **Isolation (Изоляция):**  Транзакции выполняются независимо друг от друга,  как будто последовательно.
* **Durability (Долговечность):**  После успешного завершения транзакции (`COMMIT`) изменения сохраняются в базе данных permanently.

**Типы транзакций:**

* **Явные:**  Начинаются с оператора `BEGIN TRANSACTION` (или аналогичного) и заканчиваются `COMMIT` или `ROLLBACK`.
* **Неявные:**  Начинаются автоматически при первом DML-операторе и заканчиваются `COMMIT`, `ROLLBACK` или завершением сессии.

### Журнал транзакций

**Журнал транзакций:**  Специальный файл, в котором СУБД хранит информацию о всех выполненных транзакциях.

**Информация в журнале:**

* Начало транзакции.
* Детали каждого DML-оператора (тип операции,  измененные данные).
* Завершение транзакции (COMMIT или ROLLBACK).

**Назначение журнала:**

* Восстановление базы данных после сбоев.
* Отмена транзакций (`ROLLBACK`).

## Примеры управления транзакциями:

1. **Продажа товара в кредит:**

```sql
BEGIN TRANSACTION;
INSERT INTO ЧЕК VALUES (35651, 4591, '2020-08-03', 18000, 0, 18000, 'кредит');
INSERT INTO СТРОКА VALUES (35651, 1, 65337, 1, 18000, 18000);
UPDATE ТОВАР SET ТОВ_ОСТ = ТОВ_ОСТ - 1 WHERE ТОВ_КОД = 65337;
UPDATE КЛИЕНТ SET КЛН_ДОЛГ = КЛН_ДОЛГ + 18000 WHERE КЛН_КОД = 4591;
COMMIT;
```

2. **Обновление количества товара и долга клиента:**

```sql
UPDATE ТОВАР SET ТОВ_ОСТ = ТОВ_ОСТ - 2 WHERE ТОВ_КОД = 65535;
UPDATE КЛИЕНТ SET КЛН_ДОЛГ = КЛН_ДОЛГ + 100000 WHERE КЛН_КОД = 4589;
COMMIT; -- не обязательно, если это последний оператор
```

## Заключение

В данном материале были рассмотрены основы проектирования реляционных баз данных,  нормализация отношений, реляционная алгебра, язык SQL,  а также концепции безопасности и управления транзакциями. 

**Основные моменты:**

* Нормализация отношений позволяет избежать избыточности и аномалий данных.
* SQL —  мощный язык для работы с реляционными базами данных.
* Безопасность данных  и управление транзакциями  —  важные аспекты разработки надежных и безопасных приложений баз данных.

**Дальнейшее изучение:**

* Более сложные запросы SQL (подзапросы, соединения, оконные функции).
* Процедурный SQL (хранимые процедуры,  функции,  триггеры).
* Администрирование баз данных (резервное копирование,  восстановление,  оптимизация производительности).
* NoSQL базы данных.
* Большие данные и аналитика.



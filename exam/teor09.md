### Оператор SELECT и реляционная алгебра

Оператор `SELECT` в SQL позволяет реализовать все операции реляционной алгебры.

## Язык запросов данных (DQL)

### Синтаксис оператора SELECT:

```sql
SELECT [ALL | DISTINCT] (<список полей> | *)
FROM <список таблиц>
[WHERE <предикат>]
[GROUP BY <список полей>]
[HAVING <предикат>]
[ORDER BY <список полей>];
```

**Описание:**

* **ALL:** Выбрать все строки (по умолчанию).
* **DISTINCT:** Выбрать только уникальные строки.
* **<список полей> | *:** Указать столбцы для выборки или выбрать все (`*`).
* **FROM:** Указать таблицы, из которых выбираются данные.
* **WHERE:**  Указать условие выборки.
* **GROUP BY:**  Сгруппировать строки по указанным столбцам.
* **HAVING:**  Указать условие для групп.
* **ORDER BY:**  Отсортировать результат по указанным столбцам.

**Порядок предложений:**  Фиксированный (SELECT, FROM, WHERE, GROUP BY, HAVING, ORDER BY).

### Предикаты в WHERE:

* **Операторы сравнения:** `=`, `<>`, `>`, `<`, `>=`, `<=`.
* **BETWEEN:**  Проверка вхождения значения в диапазон.
* **IN:** Проверка вхождения значения в список.
* **LIKE:**  Сравнение с шаблоном.
* **IS NULL:** Проверка на NULL-значение.
* **EXISTS:** Проверка существования строк, удовлетворяющих условию подзапроса.
* **LIMIT:** Ограничение количества возвращаемых строк.

### Пример базы данных:

```
R1 = (ФИО, Дисциплина, Оценка)
R2 = (ФИО, Группа)
R3 = (Группа, Дисциплина)
```

**Данные:**

* R1:  (Петров Ф., Базы данных, 5), (Сидоров К., Базы данных, 4), (Миронов А., Базы данных, 2), ...
* R2:  (Петров Ф., 2150), (Сидоров К., 2150), (Миронов А., 2150), ...
* R3: (2150, Базы данных), (2150, Теория информации), (2158, Сети и телекоммуникации), ...

### Примеры запросов:

1. **Список всех групп без повторений:**

```sql
SELECT DISTINCT Группа FROM R3;
```

2. **Список студентов, сдавших "Базы данных" на "отлично":**

```sql
SELECT ФИО FROM R1 WHERE Дисциплина = 'Базы данных' AND Оценка = 5;
```

3. **Студенты, пришедшие на экзамен, но не сдававшие его:**

```sql
SELECT ФИО, Дисциплина FROM R1 WHERE Оценка IS NULL;
```

4. **Список всех студентов и дисциплин, которые им нужно сдавать:**

```sql
SELECT R2.ФИО, R3.Дисциплина 
FROM R2, R3 
WHERE R2.Группа = R3.Группа;
```

5. **Список студентов, имеющих несколько двоек:**

```sql
SELECT DISTINCT a.ФИО
FROM R1 a, R1 b
WHERE a.ФИО = b.ФИО AND a.Дисциплина <> b.Дисциплина 
AND a.Оценка <= 2 AND b.Оценка <= 2;
```

### Агрегатные функции:

* **COUNT:** Подсчет количества строк или значений.
* **SUM:** Суммирование значений.
* **AVG:**  Вычисление среднего значения.
* **MIN:**  Нахождение минимального значения.
* **MAX:**  Нахождение максимального значения.

### Примеры запросов с агрегатными функциями:

1. **Количество студентов, сдававших экзамен по каждой дисциплине:**

```sql
SELECT Дисциплина, COUNT(*) AS Количество_студентов
FROM R1
GROUP BY Дисциплина;
```

2. **Количество студентов, сдавших экзамен по каждой дисциплине:**

```sql
SELECT Дисциплина, COUNT(*) AS Количество_студентов
FROM R1
WHERE Оценка IS NOT NULL
GROUP BY Дисциплина;
```

3. **Количество студентов и средний балл по каждой дисциплине и группе:**

```sql
SELECT R3.Группа, R1.Дисциплина, COUNT(*) AS Количество_студентов, AVG(Оценка) AS Средний_балл
FROM R1, R2, R3
WHERE R1.ФИО = R2.ФИО AND R2.Группа = R3.Группа AND R1.Оценка IS NOT NULL AND R1.Оценка > 2
GROUP BY R3.Группа, R1.Дисциплина;
```

## Соединения таблиц (JOIN)

### Типы соединений:

* **INNER JOIN:** Возвращает строки, имеющие совпадающие значения в обеих таблицах.
* **LEFT JOIN:**  Возвращает все строки из левой таблицы и совпадающие строки из правой.
* **RIGHT JOIN:**  Возвращает все строки из правой таблицы и совпадающие строки из левой.
* **FULL JOIN:**  Возвращает все строки из обеих таблиц.
* **CROSS JOIN:**  Возвращает декартово произведение таблиц.

### Синтаксис:

```sql
SELECT <поля>
FROM <таблица1> <тип соединения> JOIN <таблица2>
ON <условие соединения>;
```

### Примеры:

* **INNER JOIN:**

```sql
SELECT Сотрудник, Название 
FROM Сотрудники INNER JOIN Компании 
ON Сотрудники.ID_компании = Компании.ID_компании;
```

* **LEFT JOIN:**

```sql
SELECT Сотрудник, Название
FROM Сотрудники LEFT JOIN Компании
ON Сотрудники.ID_компании = Компании.ID_компании;
```

* **CROSS JOIN:**

```sql
SELECT *
FROM Сотрудники CROSS JOIN Компании;
```

## Вложенные подзапросы

**Вложенный подзапрос:** Инструкция SELECT, вложенная в другую инструкцию SELECT.

**Предикаты для вложенных подзапросов:** `IN`, `EXISTS`, `ALL`, `ANY`, `SINGULAR`, `SOME`.

**Пример:**

```sql
SELECT ФИО 
FROM R1
WHERE Дисциплина IN (SELECT Дисциплина FROM R3 WHERE Группа = '2150');
```
